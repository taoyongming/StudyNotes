##### 多线程就一定好吗

1. cpu通过给每个线程分配cpu时间片来实现伪同时运行。
2. 并发编程并不是总是能提高程序运行速度。

##### 上下文切换

任务从保存到再加载的过程就是一次上下文切换。上下文切换对系统来说意味着消耗大量的CPU时间。

##### 如何减少上下文切换次数

1. 减少锁的使用，多线程竞争锁时会引起上下文切换。
2. 使用CAS算法。Java的Atomic包使用CAS算法来更新数据，而不需要加锁。
3. 使用最少线程。避免创建不需要的线程，比如任务很少，但是创建了很多线程来处理，这样会造成大量线程都处于等待状态。
4. 协程：在单线程里实现多任务的调度，并在单线程里维持多个任务间的切换。

##### 减少上下文切换实战

使用jstack命令dump线程信息，查看线程状态。dump文件查看处于WAITING（onobjectmonitor）的线程在做什么。减少JBOSS的工作线程数，找到JBOSS的线程池配置信息，将maxThreads降到100。

##### 避免死锁

1. 一旦出现死锁，业务是可感知的，因为不能继续提供服务了，那么只能通过dump线程查看到底是哪个线程出现了问题，
2. 避免一个线程同时获取多个锁。
3. 避免一个线程在锁内同时占用多个资源，尽量保证每个锁只占用一个资源。
4. 尝试使用定时锁，使用lock.tryLock（timeout）来替代使用内部锁机制。
5. 对于数据库锁，加锁和解锁必须在一个数据库连接里，否则会出现解锁失败的情况。

##### 解决资源限制

资源限制是指在进行并发编程时，程序的执行速度受限于计算机硬件资源或软件资源。

##### 资源限制引发的问题

由于上下文切换导致CPU利用率达100%，程序运行变慢。

##### 如何解决资源限制问题

硬件资源限制问题：可以考虑使用集群并行执行程序。
软件资源限制问题：使用资源池将资源复用。比如数据库连接池和socket连接复用。
在资源限制的情况下如何进行并发编程：根据不同的资源限制调整程序的并发度。